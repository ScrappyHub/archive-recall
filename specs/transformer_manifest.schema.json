{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Archive Recall Transformer Manifest",
  "type": "object",
  "required": [
    "schema_version",
    "name",
    "version",
    "determinism_class",
    "binary_sha256",
    "capabilities",
    "parameters_schema",
    "input_constraints",
    "output_constraints",
    "rollback"
  ],
  "properties": {
    "schema_version": { "type": "string", "enum": ["v1"] },

    "name": { "type": "string", "minLength": 1, "maxLength": 128 },
    "version": { "type": "string", "minLength": 1, "maxLength": 64 },

    "determinism_class": { "type": "string", "enum": ["D0", "D1", "D2"] },

    "binary_sha256": { "type": "string", "pattern": "^[a-f0-9]{64}$" },

    "capabilities": {
      "type": "object",
      "required": ["filesystem_read", "filesystem_write", "network", "device_access"],
      "properties": {
        "filesystem_read": { "type": "boolean" },
        "filesystem_write": { "type": "boolean" },
        "network": { "type": "boolean" },
        "device_access": { "type": "boolean" }
      },
      "additionalProperties": false
    },

    "parameters_schema": { "type": "object" },

    "input_constraints": { "type": "object" },
    "output_constraints": { "type": "object" },

    "rollback": {
      "type": "object",
      "required": ["strategy"],
      "properties": {
        "strategy": { "type": "string", "enum": ["staged_commit", "checkpoint_restore"] },
        "notes": { "type": "string", "minLength": 1, "maxLength": 2000 }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
